import { PanelData } from '@grafana/data';

/**
 * Format and clean up the panel data.
 * All series are expected to be time
 * series and have unique field names.
 * @param data The data object generated by the panel.
 * @returns A formatted object of panel data.
 * `{ timestamp : { field : value, ... }, ... }`
 */
export function format(data: PanelData): { [index: string]: { [index: string]: number } } {
  const formatted: { [index: string]: { [index: string]: number } } = {};
  data.series.forEach((frame) => {
    frame.fields
      .find((field) => field.type === 'time')
      ?.values.toArray()
      .forEach((t: number, i: number) => {
        const time = new Date(t).toLocaleString();
        frame.fields
          .filter((field) => field.type === 'number')
          .forEach((numberField) => {
            formatted[time] = formatted[time] || {};
            formatted[time][numberField.name] = numberField.values.get(i);
          });
      });
  });
  return formatted;
}
